---
import Layout from "@/layouts/Layout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const tags = (await getCollection('blog')).map(post => post.data.tags).flat().filter(Boolean)
	return tags.map((tag) => ({
		params: { tag },
	}));
  
}

const { tag } = Astro.params;
---
<Layout>
  <h1 class="text-3xl font-bold mb-4">Posts tagged with "{tag}"</h1>
  <ul class="pl-5">
    {await getCollection('blog', ({ data }) => data.tags?.includes(tag)).then(posts => posts.map(post => (
      <li class="m-4 inline-block">
        <a href={`/posts/${post.id}`} class=" hover:underline">{post.data.title}</a>
      </li>
    )))}
  </ul>
