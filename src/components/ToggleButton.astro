---
import { Sun, Moon } from 'lucide-react';
---

<button
  class="inline-flex h-7 w-7 items-center justify-center rounded-md text-foreground transition hover:bg-secondary"
  aria-label="切换主题"
  title="切换主题"
  aria-pressed="false"
>
  <Sun className="hidden dark:block" size={16} />
  <Moon className="block dark:hidden" size={16} />
</button>

<script is:inline>
  (() => {
    const storageKey = "theme";
    const toggleButton = document.currentScript?.previousElementSibling;
    if (!(toggleButton instanceof HTMLButtonElement)) {
      return;
    }

    const getPreferredTheme = () => {
      const localStorageTheme = localStorage?.getItem(storageKey) ?? "";
      if (["dark", "light"].includes(localStorageTheme)) {
        return localStorageTheme;
      }
      return window.matchMedia("(prefers-color-scheme: dark)").matches
        ? "dark"
        : "light";
    };

    const applyTheme = (theme) => {
      if (theme === "light") {
        document.documentElement.classList.remove("dark");
      } else {
        document.documentElement.classList.add("dark");
      }
      localStorage.setItem(storageKey, theme);
      toggleButton.setAttribute("aria-pressed", String(theme === "dark"));
      toggleButton.setAttribute(
        "title",
        theme === "dark" ? "切换到浅色" : "切换到深色"
      );
    };

    const theme = getPreferredTheme();
    applyTheme(theme);

    toggleButton.addEventListener("click", () => {
      const isDark = document.documentElement.classList.toggle("dark");
      applyTheme(isDark ? "dark" : "light");
    });
  })();
</script>
